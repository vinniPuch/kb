<html>
<head>
   <meta charset="utf-8">

   <title></title>
   <link rel="stylesheet" type="text/css" href="../../css/style.css">
   <script type="text/javascript">
var type = 'table';
   </script>
</head>

<body>
   <div id="wrapper">
      <div class="page-title">
         <div id="title">
            <a class="logo" href="/"><span>­</span></a>

            <div class="category">
               <a class="category-link" href="/category/apache/apache.html">Apache</a>
            </div>
         </div>
      </div>

      <div id="content-wrapper" class="table-tpl2">
         <div id="header-indent"></div>

         <div class="indent"></div>

         <div id="sub-title-bar">
            <h4 class="editable" id="sub-category-sub-title">Создание и настройка виртуальных хостов</h4>
         </div>

         <table id="table-2column-2bold">
            <tbody>
               <tr>
                  <td class="firs">Создание виртуального хоста</td>

                  <td class="last">Справочник деректив сервера.<br>
                  <br>
                  http://www.apache.ru/docs/apache-2.0/mod/directives.html &nbsp;<br>
                  <br></td>
               </tr>

               <tr class="">
                  <td class="firs">1) Создать файл настройки виртуального хоста ( можно скопировать &nbsp;default )</td>

                  <td class="last"><br>
                  etc/apache2/sites-availeble example.com&nbsp;<br>
                  <br></td>
               </tr>

               <tr class="">
                  <td class="firs">
                     Пример стандартного(default) файла конфигурации виртуального хоста<br>
                     <br>
                     Listen - Устанавливает, какой порт и ip-адрес должен прослушивать Apache. Listen<br>
                     192.168.1.10:8080 - для обращения к серверу в браузере указывается http://localhost:8080 (По умолчанию порт - 80).<br>
                     <br>
                     DocumentRoot - определяет директорию, в который находятся файлы сайта. В случае поддержки сервером более одного сайта, необходимо использовать директиву VirtualHost.<br>
                     <br>
                     Directory - Директивы указанные внутри Directory будут влиять на все вложенные файлы и папки.<br>
                     <br>
                     <br>
                     Options - определяет какие опции сервера доступны в конкретном каталоге.<br>
                     <br>

                     <div>
                        &nbsp; &nbsp; All - разрешены все опции.
                     </div>

                     <div>
                        &nbsp; &nbsp; None - запрещены все опции.
                     </div>

                     <div>
                        &nbsp; &nbsp; ExecCGI - разрешено выполнение скриптов CGI
                     </div>

                     <div>
                        &nbsp; &nbsp; FollowSymLinks - разрешено следование сервером за символическими связями
                     </div>

                     <div>
                        &nbsp; &nbsp; Includes - разрешен SSI(Server-Site Includes)
                     </div>

                     <div>
                        &nbsp; &nbsp; IncludesNOEXEC - азрешен SSI, #exec и #include у CGI-скриптов заблокированы.
                     </div>

                     <div>
                        &nbsp; &nbsp; Indexes - выводить список все файлов каталога если uri не соответствует каталогу
                     </div>

                     <div>
                        &nbsp; &nbsp; MultiViews - разрешен content negotiated MultiView
                     </div>

                     <div>
                        &nbsp; &nbsp; SymLinksIfOwnerMatch - разрешено следование сервером за символическими связями, если файл или каталог имеют тот же идентификатор пользователя, что и связь.
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        <div>
                           AllowOverride - указывает, какие директивы в файле .htaccess (или другом файле, определенном в директиве AccessFileName)допустимы
                        </div>

                        <div>
                           &nbsp; &nbsp; All - допустимы все директивы.
                        </div>

                        <div>
                           &nbsp; &nbsp;None - .htaccess не обрабатывается
                        </div>

                        <div>
                           &nbsp; &nbsp;AuthConfig - разрешаются директивы: AuthDBMGroupFile, AuthDBMUserFile, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AuthGroupFile, AuthName, AuthType, AuthUserFile, require и др.
                        </div>

                        <div>
                           &nbsp; &nbsp;FileInfo - разрешены директивы, управляющие типами документов: AddEncoding, &nbsp; &nbsp;AddLanguage, AddType, DefaultType, ErrorDocument, LanguagePriority...
                        </div>

                        <div>
                           &nbsp; &nbsp;Indexes - разредены директивы индексации каталога: AddDescription, AddItem, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AddIconByEncoding, AddIconByType, DefaultIcon, DirectoryIndex, FancyIndexing, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HeaderName, IndexIgnore, IndexOptions, ReadmeName,...
                        </div>

                        <div>
                           &nbsp; &nbsp;Limit - разрешены директивы управления доступом: allow, deny, order.
                        </div>

                        <div>
                           &nbsp; &nbsp;Options - разрешены директивы, управляющие специфическими особенностями каталога: Options и XBitHack
                        </div>

                        <div>
                           <br>
                        </div>

                        <div>
                           <br>
                        </div>

                        <div>
                           Order - управляет состоянием доступа. Order может принимать 3 значения (без пробелов между словами):
                        </div>

                        <div>
                           &nbsp; &nbsp;Allow,Deny - доступ по умолчанию запрещен, кроме хостов, указанных в строке после.
                        </div>

                        <div>
                           &nbsp; Deny,Allow - доступ по умолчанию разрешен, кроме хостов, указанных в строке после.
                        </div>

                        <div>
                           &nbsp; Mutual-failure - разрешен доступ для тех хостов, которые присутствуют в Allow и отсутствуют в Deny.
                        </div>
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        <br>
                     </div>
                  </td>

                  <td class="last">
                     <div>
                        <br>
                     </div>

                     <div>
                        &lt;VirtualHost *:80&gt;
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        ServerAdmin webmaster@localhost
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        &nbsp; &nbsp; &nbsp; &nbsp; ServerName
                     </div>

                     <div>
                        &nbsp; &nbsp; &nbsp; &nbsp; ServerAlias
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        DocumentRoot /var/www
                     </div>

                     <div>
                        &lt;Directory /&gt;
                     </div>

                     <div>
                        Options FollowSymLinks
                     </div>

                     <div>
                        AllowOverride None
                     </div>

                     <div>
                        &lt;/Directory&gt;
                     </div>

                     <div>
                        &lt;Directory /var/www/&gt;
                     </div>

                     <div>
                        Options Indexes FollowSymLinks MultiViews
                     </div>

                     <div>
                        AllowOverride None
                     </div>

                     <div>
                        Order allow,deny
                     </div>

                     <div>
                        allow from all
                     </div>

                     <div>
                        &lt;/Directory&gt;
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
                     </div>

                     <div>
                        &lt;Directory "/usr/lib/cgi-bin"&gt;
                     </div>

                     <div>
                        AllowOverride None
                     </div>

                     <div>
                        Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
                     </div>

                     <div>
                        Order allow,deny
                     </div>

                     <div>
                        Allow from all
                     </div>

                     <div>
                        &lt;/Directory&gt;
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        ErrorLog ${APACHE_LOG_DIR}/error.log
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        # Possible values include: debug, info, notice, warn, error, crit,
                     </div>

                     <div>
                        # alert, emerg.
                     </div>

                     <div>
                        LogLevel warn
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        CustomLog ${APACHE_LOG_DIR}/access.log combined
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        &nbsp; &nbsp; Alias /doc/ "/usr/share/doc/"
                     </div>

                     <div>
                        &nbsp; &nbsp; &lt;Directory "/usr/share/doc/"&gt;
                     </div>

                     <div>
                        &nbsp; &nbsp; &nbsp; &nbsp; Options Indexes MultiViews FollowSymLinks
                     </div>

                     <div>
                        &nbsp; &nbsp; &nbsp; &nbsp; AllowOverride None
                     </div>

                     <div>
                        &nbsp; &nbsp; &nbsp; &nbsp; Order deny,allow
                     </div>

                     <div>
                        &nbsp; &nbsp; &nbsp; &nbsp; Deny from all
                     </div>

                     <div>
                        &nbsp; &nbsp; &nbsp; &nbsp; Allow from 127.0.0.0/255.0.0.0 ::1/128
                     </div>

                     <div>
                        &nbsp; &nbsp; &lt;/Directory&gt;
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        &lt;/VirtualHost&gt;
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        ServerName &nbsp; host[:port] &nbsp; имя &nbsp;и порт по которым доступен сервер
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        <span style="background-color: rgb(222, 223, 223);">ServerAlias one two .... &nbsp;- альтернативные &nbsp;имена хоста,(список доменов по которым доступен хост, дополняет значения до&nbsp;</span>ServerName&nbsp;<span style="background-color: rgb(222, 223, 223);">&nbsp;)</span>
                     </div>
                  </td>
               </tr>

               <tr class="">
                  <td class="firs">2) Минимально необходимое число параметров которое необходимо задать</td>

                  <td class="last">
                     <div>
                        <br>
                     </div>

                     <div>
                        ServerAlias example.com &nbsp; или &nbsp; ServerName example.com
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        DocumentRoot /home/dima/sites/test
                     </div>

                     <div>
                        <br>
                     </div>
                  </td>
               </tr>

               <tr class="">
                  <td class="firs">3) Включить хост путем добавления ссылки в&nbsp;sites-enabled</td>

                  <td class="last">
                     в ручную:<br>
                     <br>

                     <div>
                        &nbsp;ln -s /etc/apache2/sites-available/configname &nbsp; &nbsp; &nbsp; &nbsp; /etc/apache2/sites-enabled/configname
                     </div>

                     <div>
                        куда ссылка&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; откуда (где будет ярлык)
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        &nbsp;
                     </div>

                     <div>
                        встроенными командами:
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        &nbsp;a2ensite configname &nbsp; &nbsp;&nbsp;-включение (создание ссылки) &nbsp; &nbsp;
                     </div>

                     <div>
                        &nbsp;a2dissite configname &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-отключение (удаление ссылки)
                     </div>

                     <div>
                        <br>
                     </div><br>
                     <br>
                  </td>
               </tr>

               <tr class="">
                  <td class="firs">4) прописать хост в файле хостов</td>

                  <td class="last"><br>
                  127.0.0.1 example.com www.example.com<br>
                  <br>
                  или &nbsp;для новой версии протокола IP<br>
                  <br>
                  ::1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;example.com &nbsp;www.example.com<br>
                  <br>
                  <br></td>
               </tr>

               <tr class="">
                  <td class="firs">5) Перезапустить сервер&nbsp;<br>
                  <br>
                  <br>
                  или презагрузить конфигурацию<br>
                  <br>
                  В том случае если сервер станет выдавать ошибку&nbsp;<br>
                  <br>
                  Warning:"Could not reliably determine the server's fully qualified domain name, using 127.0.1.1 for ServerName";<br>
                  <br>
                  необходимо прописать имя сервера&nbsp;ServerName [Name] &nbsp;в виртуальном хосте или etc/httpd.conf<br>
                  <br></td>

                  <td class="last">&nbsp;sudo service apache2 restart<br>
                  <br>
                  <br>
                  &nbsp;sudo service apache2 reload<br>
                  <br>
                  <br></td>
               </tr>

               <tr class="">
                  <td class="firs">Несколько способов перезагрузки сервера</td>

                  <td class="last">
                     sudo /etc/init.d/apache2 restart<br>
                     <br>
                     cd /etc/init.d #sudo ./apache2 restart<br>
                     <br>
                     sudo service apache2 restart<br>
                     <br>
                     <br>
                     с&nbsp;sudo service apache2 (команда)&nbsp;можно использовать:<br>
                     <br>

                     <div>
                        start -
                     </div>

                     <div>
                        stop -
                     </div>

                     <div>
                        status -
                     </div>

                     <div>
                        restart -
                     </div>

                     <div>
                        reload -
                     </div>

                     <div>
                        graceful-stop -
                     </div>

                     <div>
                        force-reload -
                     </div>

                     <div>
                        start-htcacheclean -
                     </div>

                     <div>
                        stop-htcacheclean -
                     </div>

                     <div>
                        <br>
                     </div>
                  </td>
               </tr>

               <tr class="">
                  <td class="firs">Пример поддержки 2-ух различных сайтов одним сервером Apache</td>

                  <td class="last">
                     <div>
                        <br>
                     </div>

                     <div>
                        &lt;VirtualHost *:80&gt;
                     </div>

                     <div>
                        &nbsp; &nbsp; ServerName first.loc
                     </div>

                     <div>
                        &nbsp; &nbsp; ServerAlias www.first.loc
                     </div>

                     <div>
                        &nbsp; &nbsp; DocumentRoot "c:/www/first.loc/public"
                     </div>

                     <div>
                        &nbsp; &nbsp; ErrorLog "c:/www/first.loc/logs/error.log"
                     </div>

                     <div>
                        &lt;/VirtualHost&gt;
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        &lt;VirtualHost *:80&gt;
                     </div>

                     <div>
                        &nbsp; &nbsp; ServerName second.loc
                     </div>

                     <div>
                        &nbsp; &nbsp; ServerAlias www.second.loc
                     </div>

                     <div>
                        &nbsp; &nbsp; DocumentRoot "c:/www/second.loc/public"
                     </div>

                     <div>
                        &nbsp; &nbsp; ErrorLog "c:/www/second.loc/public"
                     </div>

                     <div>
                        &lt;/VirtualHost&gt;
                     </div>

                     <div>
                        <br>
                     </div>
                  </td>
               </tr>

               <tr class="">
                  <td class="firs">Привязка &nbsp;хостов бывает двух типов по имени и по IP</td>

                  <td class="last">
                     По имени(имееться ввиду имени хоста):<br>
                     <br>

                     <div>
                        &lt;VirtualHost *:80&gt;
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        &nbsp; ServerName www.domain.tld
                     </div>

                     <div>
                        &nbsp; ServerAlias domain.tld *.domain.tld
                     </div>

                     <div>
                        &nbsp; DocumentRoot /www/domain
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        &lt;/VirtualHost&gt;
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        &lt;VirtualHost *:80&gt;
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        &nbsp; ServerName www.otherdomain.tld&nbsp;
                     </div>

                     <div>
                        &nbsp; DocumentRoot /www/otherdomain
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        &lt;/VirtualHost&gt;
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        Пo IP:
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        <div>
                           &lt;VirtualHost www.smallco.com&gt;
                        </div>

                        <div>
                           <br>
                        </div>

                        <div>
                           &nbsp; &nbsp; ServerAdmin webmaster@mail.smallco.com
                        </div>

                        <div>
                           &nbsp; &nbsp; DocumentRoot /groups/smallco/www
                        </div>

                        <div>
                           &nbsp; &nbsp; ServerName www.smallco.com
                        </div>

                        <div>
                           &nbsp; &nbsp; ErrorLog /groups/smallco/logs/error_log
                        </div>

                        <div>
                           &nbsp; &nbsp; TransferLog /groups/smallco/logs/access_log
                        </div>

                        <div>
                           <br>
                        </div>

                        <div>
                           &lt;/VirtualHost&gt;
                        </div>

                        <div>
                           <br>
                        </div>

                        <div>
                           &lt;VirtualHost www.baygroup.org&gt;
                        </div>

                        <div>
                           <br>
                        </div>

                        <div>
                           &nbsp; &nbsp;ServerAdmin webmaster@mail.baygroup.org
                        </div>

                        <div>
                           &nbsp; &nbsp;DocumentRoot /groups/baygroup/www
                        </div>

                        <div>
                           &nbsp; &nbsp;ServerName www.baygroup.org
                        </div>

                        <div>
                           &nbsp; &nbsp;ErrorLog /groups/baygroup/logs/error_log
                        </div>

                        <div>
                           &nbsp; TransferLog /groups/baygroup/logs/access_log
                        </div>

                        <div>
                           <br>
                        </div>

                        <div>
                           &lt;/VirtualHost&gt;
                        </div>
                     </div>

                     <div>
                        <br>
                     </div>

                     <div>
                        www.smallco.com - вместо доменов можно прописать IP адрес
                     </div>

                     <div>
                        <br>
                     </div>
                  </td>
               </tr>
            </tbody>
         </table>

         <div id="fake-footer"></div>
      </div>

      <div class="page-footer">
         <div id="footer">
            <a class="logo" href="/"><span>­</span></a>

            <div class="category">
               <a class="category-link" href="/category/apache/apache.html">Apache</a>
            </div>
         </div>
      </div>

      <div class="footer-indent"></div>
   </div>
</body>
</html>
